# 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

이 코드는 어떻게 돌아갈까?

```js
var a = 1;
const y = 2;

function foo(a) {
  var x = 3;
  const y = 4;

  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z);
  }
  bar(10);
}
```

## 전역 객체 생성

전역 객체는 전역 코드가 평가 되기 이전에 생성된다.  
이때 전역 객체는 빌트인 전역 프로퍼티와 빌트인 전역 함수, 그리고 표준 빌트인 객체가 추가되며 동작 환경(클라이언트 사이드 또는 서버 사이드)에 따라 클라이언트 사이드 Web API(DOM, Bom, Canvas, XMLHttpRequest, fetch, requestAnimationFrame, SVG, Web Storage, Web Component, Web Worker 등) 또는 특정 환경을 위한 호스트 객체를 포함한다.

전역 객체도 Object.prototype을 상속받으므로 프로토타입 체인의 일원이다.

## 전역 코드 평가

소스코드가 로드되면 자바스크립트 엔진은 전역 코드를 평가한다.  
전역 코드 평가는 다음과 같은 순서로 진행된다.

1. 전역 실행 컨텍스트 생성
2. 전역 렉시컬 환경 생성
   - 2.1 전역 환경 레코드 생성
     - 2.1.1 객체 환경 레코드 생성
     - 2.1.2 선언적 환경 레코드 생성
   - 2.2 this 바인딩
   - 2.3 외부 렉시컬 환경에 대한 참조 결정

### 1. 전역 실행 컨텍스트 생성

먼저 비어있는 전역 실행 컨텍스트를 생성하여 실행 컨텍스트 스택에 푸쉬한다.  
이때 전역 실행 컨텍스트는 실행 컨텍스트 스택의 최상위, 즉 실행 중인 실행 컨텍스트(running execution context)가 된다.

### 2. 전역 렉시컬 환경 생성

전역 렉시컬 환경(Global Lexical Environment)을 생성하고 전역 실행 컨텍스트에 바인딩한다.

렉시컬 환경은 환경 레코드(Environment Record)와 외부 렉시컬 환경(OuterLexicalEnvironmentReference)에 대한 참조 2개의 컴포넌트로 구성되어 있다.

#### 2.1 전역 환경 레코드 생성

## 전역 코드 실행

## foo 함수 코드 평가

## foo 함수 코드 실행

## bar 함수 코드 평가

## bar 함수 코드 실행

## foo 함수 코드 실행 종료

## bar 함수 코드 실행 종료

## 전역 코드 실행 종료
