# 23.4 실행 컨텍스트 스택

자바스크립트 엔진은 전역 코드를 머저 평가하여 전역 실행 컨텍스트를 생성한다.  
그리고 함수가 호출되면 함수 코르를 평가하여 함수 실행 컨텍스트를 생성한다.

생성된 실행 컨텍스트는 스택(stack, call stack이라고도 부름) 자료구조로 관리한다.  
이를 실행 컨텍스트 스택이라 한다.

실행 컨텍스트 스택은 코드의 실행 순서를 관리한다.  
소스코드가 평가되면 실행 컨텍스트가 생성되고 실행 컨텍스트 스택의 최상위에 쌓인다.
코드를 실행하면 실행되는 시간의 흐름에 따라 실행 컨텍스트 스택에는 실행 컨텍스트가 추가(push)되고 제거(pop)된다.

실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행 중인 코드의 실행 컨텍스트다.  
실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트를 실행 중인 실행 컨텍스트(running execution context)라 부른다.

## 예제

```js
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}

foo(); // 6
```

1. 전역 코드의 평가와 실행
   - 자바스크립트 엔진은 전역코드를 먼저 평가하여 전역 실행 컨텍스트를 생성하고 실행 컨텍스트의 스택에 푸쉬 : 전역 변수 x, 전역 함수 foo 전역 실행 컨텍스트에 등록
   - 전역 코드가 실행되기 시작 : 전역 변수 x에 값이 할당, 전역 함수 foo 호출

<br />

2. foo 함수 코드의 평가와 실행
   - 전역 함수 foo 호출 : 전역 코드 실행 일시 중단, 코드의 제어권(control)이 foo 함수 내부로 이동
   - 자바스크립트 엔진은 foo 함수 내부 함수 코드 평가하여 foo 함수 실행 컨텍스트 생성 후 실행 컨텍스트 스택에 푸시 : foo 함수의 지역 변수 y와 중첩 함수 bar가 함수 실행 컨텍스트에 등록
   - foo 함수 코드 실행시작 : 지역 변수 y에 값이 할당, 중첩 함수 bar 호출

<br />

3. bar 함수 코드의 평가와 실행
   - 중첩 함수 bar 호출 : foo 함수 코드의 실행 일시 중단, 코드의 제어권이 bar 함수 내부로 이동
   - 자바스크립트 엔진은 bar 함수 내부의 함수 코드를 평가하여 bar 함수 실행 컨텍스트 생성 후 실행 컨텍스트 스택에 푸시 : bar 함수의 지역 변수 z가 bar 함수 실행 컨텍스트에 등록
   - bar 함수 코드 실행 시작 : 지역 변수 z에 값이 할당, console.log 메서드 호출 후 bar 함수 종료

<br />

4. foo 함수 코드로 복귀
   - 코드 제어권은 다시 foo 함수로 이동
   - 자바스크립트 엔진이 bar 함수 실행 컨텍스트를 실행 컨텍스트 스택에서 팝하여 제거
   - foo 함수 종료

<br />

5. 전역 코드 복귀
   - 코드 제어권은 다시 전역 코드로 이동
   - 자바스크립트 엔진이 foo 함수 실행 컨텍스트를 실행 컨텍스트 스택에서 팝하여 제거
   - 더 이상 실행할 전역 코드가 남지 않음 : 전역 실행 컨텍스트도 실행 컨텍스트 스택에서 팝되어 제거, 실행 컨텍스트 스택에 아무것도 남지 않음
